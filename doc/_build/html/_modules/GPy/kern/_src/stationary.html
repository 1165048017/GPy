<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GPy.kern._src.stationary &mdash; GPy  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static//default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="GPy  documentation" href="../../../../index.html" />
    <link rel="up" title="GPy" href="../../../GPy.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">GPy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../../GPy.html" accesskey="U">GPy</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for GPy.kern._src.stationary</h1><div class="highlight"><pre>
<span class="c"># Copyright (c) 2012, GPy authors (see AUTHORS.txt).</span>
<span class="c"># Licensed under the BSD 3-clause license (see LICENSE.txt)</span>


<span class="kn">from</span> <span class="nn">kern</span> <span class="kn">import</span> <span class="n">Kern</span>
<span class="kn">from</span> <span class="nn">...core.parameterization</span> <span class="kn">import</span> <span class="n">Param</span>
<span class="kn">from</span> <span class="nn">...core.parameterization.transformations</span> <span class="kn">import</span> <span class="n">Logexp</span>
<span class="kn">from</span> <span class="nn">...util.linalg</span> <span class="kn">import</span> <span class="n">tdot</span>
<span class="kn">from</span> <span class="nn">...</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">weave</span>
<span class="kn">from</span> <span class="nn">...util.config</span> <span class="kn">import</span> <span class="n">config</span> <span class="c"># for assesing whether to use weave</span>
<span class="kn">from</span> <span class="nn">...util.caching</span> <span class="kn">import</span> <span class="n">Cache_this</span>

<div class="viewcode-block" id="Stationary"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary">[docs]</a><span class="k">class</span> <span class="nc">Stationary</span><span class="p">(</span><span class="n">Kern</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stationary kernels (covariance functions).</span>

<span class="sd">    Stationary covariance fucntion depend only on r, where r is defined as</span>

<span class="sd">      r = \sqrt{ \sum_{q=1}^Q (x_q - x&#39;_q)^2 }</span>

<span class="sd">    The covariance function k(x, x&#39; can then be written k(r).</span>

<span class="sd">    In this implementation, r is scaled by the lengthscales parameter(s):</span>

<span class="sd">      r = \sqrt{ \sum_{q=1}^Q \frac{(x_q - x&#39;_q)^2}{\ell_q^2} }.</span>

<span class="sd">    By default, there&#39;s only one lengthscale: seaprate lengthscales for each</span>
<span class="sd">    dimension can be enables by setting ARD=True.</span>

<span class="sd">    To implement a stationary covariance function using this class, one need</span>
<span class="sd">    only define the covariance function k(r), and it derivative.</span>

<span class="sd">      ...</span>
<span class="sd">      def K_of_r(self, r):</span>
<span class="sd">          return foo</span>
<span class="sd">      def dK_dr(self, r):</span>
<span class="sd">          return bar</span>

<span class="sd">    The lengthscale(s) and variance parameters are added to the structure automatically.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">ARD</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">useGPU</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Stationary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span><span class="n">useGPU</span><span class="o">=</span><span class="n">useGPU</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ARD</span> <span class="o">=</span> <span class="n">ARD</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ARD</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lengthscale</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">lengthscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lengthscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lengthscale</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">lengthscale</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Only 1 lengthscale needed for non-ARD kernel&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lengthscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">lengthscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lengthscale</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">lengthscale</span><span class="o">.</span><span class="n">size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">],</span> <span class="s">&quot;Bad number of lengthscales&quot;</span>
                <span class="k">if</span> <span class="n">lengthscale</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">input_dim</span><span class="p">:</span>
                    <span class="n">lengthscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">input_dim</span><span class="p">)</span><span class="o">*</span><span class="n">lengthscale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lengthscale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="s">&#39;lengthscale&#39;</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">Logexp</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="s">&#39;variance&#39;</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">Logexp</span><span class="p">())</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">size</span><span class="o">==</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="p">)</span>

<div class="viewcode-block" id="Stationary.K_of_r"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.K_of_r">[docs]</a>    <span class="k">def</span> <span class="nf">K_of_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">,</span> <span class="s">&quot;implement the covariance function as a fn of r to use this class&quot;</span>
</div>
<div class="viewcode-block" id="Stationary.dK_dr"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.dK_dr">[docs]</a>    <span class="k">def</span> <span class="nf">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">,</span> <span class="s">&quot;implement derivative of the covariance function wrt r to use this class&quot;</span>
</div>
    <span class="nd">@Cache_this</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ignore_args</span><span class="o">=</span><span class="p">())</span>
<div class="viewcode-block" id="Stationary.K"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.K">[docs]</a>    <span class="k">def</span> <span class="nf">K</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Kernel function applied on inputs X and X2.</span>
<span class="sd">        In the stationary case there is an inner function depending on the</span>
<span class="sd">        distances from X to X2, called r.</span>

<span class="sd">        K(X, X2) = K_of_r((X-X2)**2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaled_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">K_of_r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</div>
    <span class="nd">@Cache_this</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ignore_args</span><span class="o">=</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">dK_dr_via_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">):</span>
        <span class="c">#a convenience function, so we can cache dK_dr</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaled_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_unscaled_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the Euclidean distance between each row of X and X2, or between</span>
<span class="sd">        each pair of rows of X if X2 is None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#X, = self._slice_X(X)</span>
        <span class="k">if</span> <span class="n">X2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">Xsq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">tdot</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">Xsq</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">Xsq</span><span class="p">[</span><span class="bp">None</span><span class="p">,:])</span>
            <span class="n">util</span><span class="o">.</span><span class="n">diag</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">r2</span><span class="p">)[:,]</span><span class="o">=</span> <span class="mf">0.</span> <span class="c"># force diagnoal to be zero: sometime numerically a little negative</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#X2, = self._slice_X(X2)</span>
            <span class="n">X1sq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">X2sq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">X2</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">X1sq</span><span class="p">[:,</span><span class="bp">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">X2sq</span><span class="p">[</span><span class="bp">None</span><span class="p">,:]</span>
            <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">r2</span><span class="p">)</span>

    <span class="nd">@Cache_this</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ignore_args</span><span class="o">=</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">_scaled_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Efficiently compute the scaled distance, r.</span>

<span class="sd">        r = \sqrt( \sum_{q=1}^Q (x_q - x&#39;q)^2/l_q^2 )</span>

<span class="sd">        Note that if thre is only one lengthscale, l comes outside the sum. In</span>
<span class="sd">        this case we compute the unscaled distance first (in a separate</span>
<span class="sd">        function for caching) and divide by lengthscale afterwards</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARD</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">X2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">X2</span> <span class="o">=</span> <span class="n">X2</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unscaled_dist</span><span class="p">(</span><span class="n">X</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unscaled_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span>

<div class="viewcode-block" id="Stationary.Kdiag"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.Kdiag">[docs]</a>    <span class="k">def</span> <span class="nf">Kdiag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ret</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Stationary.update_gradients_diag"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.update_gradients_diag">[docs]</a>    <span class="k">def</span> <span class="nf">update_gradients_diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dKdiag</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the derivative of the objective with respect to the diagonal of</span>
<span class="sd">        the covariance matrix, compute the derivative wrt the parameters of</span>
<span class="sd">        this kernel and stor in the &lt;parameter&gt;.gradient field.</span>

<span class="sd">        See also update_gradients_full</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dL_dKdiag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="mf">0.</span>
</div>
<div class="viewcode-block" id="Stationary.update_gradients_full"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.update_gradients_full">[docs]</a>    <span class="k">def</span> <span class="nf">update_gradients_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the derivative of the objective wrt the covariance matrix</span>
<span class="sd">        (dL_dK), compute the gradient wrt the parameters of this kernel,</span>
<span class="sd">        and store in the parameters object as e.g. self.variance.gradient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;ij,ij,i&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">),</span> <span class="n">dL_dK</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">)</span>

        <span class="c">#now the lengthscale gradient(s)</span>
        <span class="n">dL_dr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK_dr_via_X</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dL_dK</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ARD</span><span class="p">:</span>
            <span class="c">#rinv = self._inv_dis# this is rather high memory? Should we loop instead?t(X, X2)</span>
            <span class="c">#d =  X[:, None, :] - X2[None, :, :]</span>
            <span class="c">#x_xl3 = np.square(d)</span>
            <span class="c">#self.lengthscale.gradient = -((dL_dr*rinv)[:,:,None]*x_xl3).sum(0).sum(0)/self.lengthscale**3</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">dL_dr</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_inv_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">X2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">X2</span> <span class="o">=</span> <span class="n">X</span>
            

            <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weave_lengthscale_grads</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Weave compilation failed. Falling back to (slower) numpy implementation</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;ij,ij,...&#39;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="n">q</span><span class="p">:</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">X2</span><span class="p">[:,</span><span class="n">q</span><span class="p">:</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s">&#39;ij,ij,...&#39;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="n">q</span><span class="p">:</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">X2</span><span class="p">[:,</span><span class="n">q</span><span class="p">:</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="p">[</span><span class="n">q</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaled_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dL_dr</span><span class="o">*</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span>

</div>
    <span class="k">def</span> <span class="nf">_inv_dist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the elementwise inverse of the distance matrix, expecpt on the</span>
<span class="sd">        diagonal, where we return zero (the distance on the diagonal is zero).</span>
<span class="sd">        This term appears in derviatives.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaled_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">dist</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

<div class="viewcode-block" id="Stationary.weave_lengthscale_grads"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.weave_lengthscale_grads">[docs]</a>    <span class="k">def</span> <span class="nf">weave_lengthscale_grads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use scipy.weave to compute derivatives wrt the lengthscales&quot;&quot;&quot;</span>
        <span class="n">N</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s">&#39;values&#39;</span><span class="p">):</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="s">&#39;values&#39;</span><span class="p">):</span><span class="n">X2</span> <span class="o">=</span> <span class="n">X2</span><span class="o">.</span><span class="n">values</span>
        <span class="n">grads</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        double gradq;</span>
<span class="s">        for(int q=0; q&lt;Q; q++){</span>
<span class="s">          gradq = 0;</span>
<span class="s">          for(int n=0; n&lt;N; n++){</span>
<span class="s">            for(int m=0; m&lt;M; m++){</span>
<span class="s">              gradq += tmp(n,m)*(X(n,q)-X2(m,q))*(X(n,q)-X2(m,q));</span>
<span class="s">            }</span>
<span class="s">          }</span>
<span class="s">          grads(q) = gradq;</span>
<span class="s">        }</span>
<span class="s">        &quot;&quot;&quot;</span>
        <span class="n">weave</span><span class="o">.</span><span class="n">inline</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="s">&#39;X2&#39;</span><span class="p">,</span> <span class="s">&#39;grads&#39;</span><span class="p">,</span> <span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="s">&#39;Q&#39;</span><span class="p">],</span> <span class="n">type_converters</span><span class="o">=</span><span class="n">weave</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">blitz</span><span class="p">,</span> <span class="n">support_code</span><span class="o">=</span><span class="s">&quot;#include &lt;math.h&gt;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">grads</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">3</span>
</div>
<div class="viewcode-block" id="Stationary.gradients_X"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.gradients_X">[docs]</a>    <span class="k">def</span> <span class="nf">gradients_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the derivative of the objective wrt K (dL_dK), compute the derivative wrt X</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">getboolean</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradients_X_weave</span><span class="p">(</span><span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s"> Weave compilation failed. Falling back to (slower) numpy implementation</span><span class="se">\n</span><span class="s">&quot;</span>
                <span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradients_X_</span><span class="p">(</span><span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradients_X_</span><span class="p">(</span><span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Stationary.gradients_X_"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.gradients_X_">[docs]</a>    <span class="k">def</span> <span class="nf">gradients_X_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">invdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="n">dL_dr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK_dr_via_X</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dL_dK</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">invdist</span><span class="o">*</span><span class="n">dL_dr</span>
        <span class="k">if</span> <span class="n">X2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="n">tmp</span><span class="o">.</span><span class="n">T</span>
            <span class="n">X2</span> <span class="o">=</span> <span class="n">X</span>

        <span class="c">#The high-memory numpy way:</span>
        <span class="c">#d =  X[:, None, :] - X2[None, :, :]</span>
        <span class="c">#ret = np.sum(tmp[:,:,None]*d,1)/self.lengthscale**2</span>

        <span class="c">#the lower memory way with a loop</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tmp</span><span class="o">*</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="n">q</span><span class="p">][:,</span><span class="bp">None</span><span class="p">]</span><span class="o">-</span><span class="n">X2</span><span class="p">[:,</span><span class="n">q</span><span class="p">][</span><span class="bp">None</span><span class="p">,:]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">ret</span><span class="p">[:,</span><span class="n">q</span><span class="p">])</span>
        <span class="n">ret</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">2</span>

        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Stationary.gradients_X_weave"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.gradients_X_weave">[docs]</a>    <span class="k">def</span> <span class="nf">gradients_X_weave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">invdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="n">dL_dr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dK_dr_via_X</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span> <span class="o">*</span> <span class="n">dL_dK</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">invdist</span><span class="o">*</span><span class="n">dL_dr</span>
        <span class="k">if</span> <span class="n">X2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="n">tmp</span><span class="o">.</span><span class="n">T</span>
            <span class="n">X2</span> <span class="o">=</span> <span class="n">X</span>

        <span class="n">code</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        int n,m,d;</span>
<span class="s">        double retnd;</span>
<span class="s">        #pragma omp parallel for private(n,d, retnd, m)</span>
<span class="s">        for(d=0;d&lt;D;d++){</span>
<span class="s">          for(n=0;n&lt;N;n++){</span>
<span class="s">            retnd = 0.0;</span>
<span class="s">            for(m=0;m&lt;M;m++){</span>
<span class="s">              retnd += tmp(n,m)*(X(n,d)-X2(m,d));</span>
<span class="s">            }</span>
<span class="s">            ret(n,d) = retnd;</span>
<span class="s">          }</span>
<span class="s">        }</span>
<span class="s"> </span>
<span class="s">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s">&#39;values&#39;</span><span class="p">):</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">values</span> <span class="c">#remove the GPy wrapping to make passing into weave safe</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="s">&#39;values&#39;</span><span class="p">):</span><span class="n">X2</span> <span class="o">=</span> <span class="n">X2</span><span class="o">.</span><span class="n">values</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">N</span><span class="p">,</span><span class="n">D</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">N</span><span class="p">,</span><span class="n">M</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">shape</span>
        <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">weave</span>
        <span class="n">support_code</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">        #include &lt;omp.h&gt;</span>
<span class="s">        #include &lt;stdio.h&gt;</span>
<span class="s">        &quot;&quot;&quot;</span>
        <span class="n">weave_options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;headers&#39;</span>           <span class="p">:</span> <span class="p">[</span><span class="s">&#39;&lt;omp.h&gt;&#39;</span><span class="p">],</span>
                         <span class="s">&#39;extra_compile_args&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;-fopenmp -O3&#39;</span><span class="p">],</span> <span class="c"># -march=native&#39;],</span>
                         <span class="s">&#39;extra_link_args&#39;</span>   <span class="p">:</span> <span class="p">[</span><span class="s">&#39;-lgomp&#39;</span><span class="p">]}</span>
        <span class="n">weave</span><span class="o">.</span><span class="n">inline</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;ret&#39;</span><span class="p">,</span> <span class="s">&#39;N&#39;</span><span class="p">,</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="s">&#39;M&#39;</span><span class="p">,</span> <span class="s">&#39;tmp&#39;</span><span class="p">,</span> <span class="s">&#39;X&#39;</span><span class="p">,</span> <span class="s">&#39;X2&#39;</span><span class="p">],</span> <span class="n">type_converters</span><span class="o">=</span><span class="n">weave</span><span class="o">.</span><span class="n">converters</span><span class="o">.</span><span class="n">blitz</span><span class="p">,</span> <span class="n">support_code</span><span class="o">=</span><span class="n">support_code</span><span class="p">,</span> <span class="o">**</span><span class="n">weave_options</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">2</span>
    </div>
<div class="viewcode-block" id="Stationary.gradients_X_diag"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.gradients_X_diag">[docs]</a>    <span class="k">def</span> <span class="nf">gradients_X_diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dKdiag</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Stationary.input_sensitivity"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Stationary.input_sensitivity">[docs]</a>    <span class="k">def</span> <span class="nf">input_sensitivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summarize</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">2</span>
</div></div>
<div class="viewcode-block" id="Exponential"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Exponential">[docs]</a><span class="k">class</span> <span class="nc">Exponential</span><span class="p">(</span><span class="n">Stationary</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Exponential&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Exponential</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">ARD</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Exponential.K_of_r"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Exponential.K_of_r">[docs]</a>    <span class="k">def</span> <span class="nf">K_of_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Exponential.dK_dr"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Exponential.dK_dr">[docs]</a>    <span class="k">def</span> <span class="nf">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K_of_r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="OU"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.OU">[docs]</a><span class="k">class</span> <span class="nc">OU</span><span class="p">(</span><span class="n">Stationary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    OU kernel:</span>

<span class="sd">    .. math::</span>

<span class="sd">       k(r) = \\sigma^2 \exp(- r) \\ \\ \\ \\  \\text{ where  } r = \sqrt{\sum_{i=1}^input_dim \\frac{(x_i-y_i)^2}{\ell_i^2} }</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;OU&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">OU</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">ARD</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="OU.K_of_r"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.OU.K_of_r">[docs]</a>    <span class="k">def</span> <span class="nf">K_of_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="OU.dK_dr"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.OU.dK_dr">[docs]</a>    <span class="k">def</span> <span class="nf">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">1.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Matern32"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Matern32">[docs]</a><span class="k">class</span> <span class="nc">Matern32</span><span class="p">(</span><span class="n">Stationary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matern 3/2 kernel:</span>

<span class="sd">    .. math::</span>

<span class="sd">       k(r) = \\sigma^2 (1 + \\sqrt{3} r) \exp(- \sqrt{3} r) \\ \\ \\ \\  \\text{ where  } r = \sqrt{\sum_{i=1}^input_dim \\frac{(x_i-y_i)^2}{\ell_i^2} }</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Mat32&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Matern32</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">ARD</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Matern32.K_of_r"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Matern32.K_of_r">[docs]</a>    <span class="k">def</span> <span class="nf">K_of_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matern32.dK_dr"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Matern32.dK_dr">[docs]</a>    <span class="k">def</span> <span class="nf">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">3.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matern32.Gram_matrix"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Matern32.Gram_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">Gram_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">F2</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the Gram matrix of the vector of functions F with respect to the</span>
<span class="sd">        RKHS norm. The use of this function is limited to input_dim=1.</span>

<span class="sd">        :param F: vector of functions</span>
<span class="sd">        :type F: np.array</span>
<span class="sd">        :param F1: vector of derivatives of F</span>
<span class="sd">        :type F1: np.array</span>
<span class="sd">        :param F2: vector of second derivatives of F</span>
<span class="sd">        :type F2: np.array</span>
<span class="sd">        :param lower,upper: boundaries of the input domain</span>
<span class="sd">        :type lower,upper: floats</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="mf">3.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span> <span class="o">*</span> <span class="n">F1</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">F2</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">))</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
                <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">L</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">L</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Flower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">F</span><span class="p">])[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="n">F1lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">F1</span><span class="p">])[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="k">return</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="mf">12.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">)</span> <span class="o">*</span> <span class="n">G</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Flower</span><span class="p">,</span> <span class="n">Flower</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">F1lower</span><span class="p">,</span> <span class="n">F1lower</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="Matern52"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Matern52">[docs]</a><span class="k">class</span> <span class="nc">Matern52</span><span class="p">(</span><span class="n">Stationary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matern 5/2 kernel:</span>

<span class="sd">    .. math::</span>

<span class="sd">       k(r) = \sigma^2 (1 + \sqrt{5} r + \\frac53 r^2) \exp(- \sqrt{5} r)</span>
<span class="sd">       &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Mat52&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Matern52</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">ARD</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Matern52.K_of_r"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Matern52.K_of_r">[docs]</a>    <span class="k">def</span> <span class="nf">K_of_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="o">+</span><span class="mf">5.</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matern52.dK_dr"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Matern52.dK_dr">[docs]</a>    <span class="k">def</span> <span class="nf">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="p">(</span><span class="mf">10.</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">r</span> <span class="o">-</span><span class="mf">5.</span><span class="o">*</span><span class="n">r</span> <span class="o">-</span><span class="mf">5.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">5.</span><span class="p">)</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Matern52.Gram_matrix"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Matern52.Gram_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">Gram_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">F1</span><span class="p">,</span> <span class="n">F2</span><span class="p">,</span> <span class="n">F3</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the Gram matrix of the vector of functions F with respect to the RKHS norm. The use of this function is limited to input_dim=1.</span>

<span class="sd">        :param F: vector of functions</span>
<span class="sd">        :type F: np.array</span>
<span class="sd">        :param F1: vector of derivatives of F</span>
<span class="sd">        :type F1: np.array</span>
<span class="sd">        :param F2: vector of second derivatives of F</span>
<span class="sd">        :type F2: np.array</span>
<span class="sd">        :param F3: vector of third derivatives of F</span>
<span class="sd">        :type F3: np.array</span>
<span class="sd">        :param lower,upper: boundaries of the input domain</span>
<span class="sd">        :type lower,upper: floats</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="k">def</span> <span class="nf">L</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
            <span class="k">return</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">15.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">F1</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">)</span><span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">*</span><span class="n">F2</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">F3</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">))</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
                <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">G</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">L</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">L</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">j</span><span class="p">),</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">G_coef</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="mi">400</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">Flower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">F</span><span class="p">])[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">F1lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">F1</span><span class="p">])[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">F2lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">F2</span><span class="p">])[:,</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">orig</span> <span class="o">=</span> <span class="mf">9.</span><span class="o">/</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Flower</span><span class="p">,</span><span class="n">Flower</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="mf">9.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mi">200</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">F2lower</span><span class="p">,</span><span class="n">F2lower</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">orig2</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">/</span><span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lengthscale</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">F1lower</span><span class="p">,</span><span class="n">F1lower</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Flower</span><span class="p">,</span><span class="n">F2lower</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">8</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">F2lower</span><span class="p">,</span><span class="n">Flower</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="k">return</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span> <span class="p">(</span><span class="n">G_coef</span><span class="o">*</span><span class="n">G</span> <span class="o">+</span> <span class="n">orig</span> <span class="o">+</span> <span class="n">orig2</span><span class="p">))</span>

</div></div>
<div class="viewcode-block" id="ExpQuad"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.ExpQuad">[docs]</a><span class="k">class</span> <span class="nc">ExpQuad</span><span class="p">(</span><span class="n">Stationary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The Exponentiated quadratic covariance function.</span>

<span class="sd">    .. math::</span>

<span class="sd">       k(r) = \sigma^2 (1 + \sqrt{5} r + \\frac53 r^2) \exp(- \sqrt{5} r)</span>

<span class="sd">    notes::</span>
<span class="sd">     - Yes, this is exactly the same as the RBF covariance function, but the</span>
<span class="sd">       RBF implementation also has some features for doing variational kernels</span>
<span class="sd">       (the psi-statistics).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;ExpQuad&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ExpQuad</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">ARD</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="ExpQuad.K_of_r"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.ExpQuad.K_of_r">[docs]</a>    <span class="k">def</span> <span class="nf">K_of_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ExpQuad.dK_dr"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.ExpQuad.dK_dr">[docs]</a>    <span class="k">def</span> <span class="nf">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">K_of_r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Cosine"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Cosine">[docs]</a><span class="k">class</span> <span class="nc">Cosine</span><span class="p">(</span><span class="n">Stationary</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;Cosine&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Cosine</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">ARD</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Cosine.K_of_r"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Cosine.K_of_r">[docs]</a>    <span class="k">def</span> <span class="nf">K_of_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Cosine.dK_dr"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.Cosine.dK_dr">[docs]</a>    <span class="k">def</span> <span class="nf">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="RatQuad"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.RatQuad">[docs]</a><span class="k">class</span> <span class="nc">RatQuad</span><span class="p">(</span><span class="n">Stationary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rational Quadratic Kernel</span>

<span class="sd">    .. math::</span>

<span class="sd">       k(r) = \sigma^2 \\bigg( 1 + \\frac{r^2}{2} \\bigg)^{- \\alpha}</span>

<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">lengthscale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">power</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">ARD</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;RatQuad&#39;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RatQuad</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">lengthscale</span><span class="p">,</span> <span class="n">ARD</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="s">&#39;power&#39;</span><span class="p">,</span> <span class="n">power</span><span class="p">,</span> <span class="n">Logexp</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span>

<div class="viewcode-block" id="RatQuad.K_of_r"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.RatQuad.K_of_r">[docs]</a>    <span class="k">def</span> <span class="nf">K_of_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">r2</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RatQuad.dK_dr"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.RatQuad.dK_dr">[docs]</a>    <span class="k">def</span> <span class="nf">dK_dr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">r2</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="RatQuad.update_gradients_full"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.RatQuad.update_gradients_full">[docs]</a>    <span class="k">def</span> <span class="nf">update_gradients_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RatQuad</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_gradients_full</span><span class="p">(</span><span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaled_dist</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="mf">2.</span><span class="p">)</span>
        <span class="n">dK_dpow</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">r2</span> <span class="o">+</span> <span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">r2</span><span class="o">+</span><span class="mf">2.</span><span class="p">))</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dL_dK</span><span class="o">*</span><span class="n">dK_dpow</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="n">grad</span>
</div>
<div class="viewcode-block" id="RatQuad.update_gradients_diag"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.stationary.RatQuad.update_gradients_diag">[docs]</a>    <span class="k">def</span> <span class="nf">update_gradients_diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dKdiag</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">RatQuad</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">update_gradients_diag</span><span class="p">(</span><span class="n">dL_dKdiag</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="mf">0.</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">GPy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../../GPy.html" >GPy</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>