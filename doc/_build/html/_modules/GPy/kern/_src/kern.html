<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GPy.kern._src.kern &mdash; GPy  documentation</title>
    
    <link rel="stylesheet" href="../../../../_static//default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="GPy  documentation" href="../../../../index.html" />
    <link rel="up" title="GPy" href="../../../GPy.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">GPy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../../GPy.html" accesskey="U">GPy</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for GPy.kern._src.kern</h1><div class="highlight"><pre>
<span class="c"># Copyright (c) 2012, GPy authors (see AUTHORS.txt).</span>
<span class="c"># Licensed under the BSD 3-clause license (see LICENSE.txt)</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">...core.parameterization.parameterized</span> <span class="kn">import</span> <span class="n">Parameterized</span>
<span class="kn">from</span> <span class="nn">kernel_slice_operations</span> <span class="kn">import</span> <span class="n">KernCallsViaSlicerMeta</span>
<span class="kn">from</span> <span class="nn">...util.caching</span> <span class="kn">import</span> <span class="n">Cache_this</span>
<span class="kn">from</span> <span class="nn">GPy.core.parameterization.observable_array</span> <span class="kn">import</span> <span class="n">ObsAr</span>



<div class="viewcode-block" id="Kern"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern">[docs]</a><span class="k">class</span> <span class="nc">Kern</span><span class="p">(</span><span class="n">Parameterized</span><span class="p">):</span>
    <span class="c">#===========================================================================</span>
    <span class="c"># This adds input slice support. The rather ugly code for slicing can be</span>
    <span class="c"># found in kernel_slice_operations</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">KernCallsViaSlicerMeta</span>
    <span class="c">#===========================================================================</span>
    <span class="n">_support_GPU</span><span class="o">=</span><span class="bp">False</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">useGPU</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The base class for a kernel: a positive definite function</span>
<span class="sd">        which forms of a covariance function (kernel).</span>

<span class="sd">        input_dim:</span>

<span class="sd">            is the number of dimensions to work on. Make sure to give the</span>
<span class="sd">            tight dimensionality of inputs.</span>
<span class="sd">            You most likely want this to be the integer telling the number of</span>
<span class="sd">            input dimensions of the kernel.</span>
<span class="sd">            If this is not an integer (!) we will work on the whole input matrix X,</span>
<span class="sd">            and not check whether dimensions match or not (!).</span>

<span class="sd">        active_dims:</span>

<span class="sd">            is the active_dimensions of inputs X we will work on.</span>
<span class="sd">            All kernels will get sliced Xes as inputs, if active_dims is not None</span>
<span class="sd">            Only positive integers are allowed in active_dims!</span>
<span class="sd">            if active_dims is None, slicing is switched off and all X will be passed through as given.</span>

<span class="sd">        :param int input_dim: the number of input dimensions to the function</span>
<span class="sd">        :param array-like|None active_dims: list of indices on which dimensions this kernel works on, or none if no slicing</span>

<span class="sd">        Do not instantiate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Kern</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">input_dim</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">active_dims</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">active_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">input_dim</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">active_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">active_dims</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_dims</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span> <span class="s">&quot;input_dim={} does not match len(active_dim)={}, active_dims={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_dims</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_dims</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_sliced_X</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">useGPU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_support_GPU</span> <span class="ow">and</span> <span class="n">useGPU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_return_psi2_n_flag</span> <span class="o">=</span> <span class="n">ObsAr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">return_psi2_n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flag whether to pass back psi2 as NxMxM or MxM, by summing out N.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_return_psi2_n_flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nd">@return_psi2_n.setter</span>
    <span class="k">def</span> <span class="nf">return_psi2_n</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Kern</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_return_psi2_n_flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traverse</span><span class="p">(</span><span class="n">visit</span><span class="p">)</span>

    <span class="nd">@Cache_this</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_slice_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">X</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_dims</span><span class="p">]</span>

<div class="viewcode-block" id="Kern.K"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.K">[docs]</a>    <span class="k">def</span> <span class="nf">K</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the kernel function.</span>

<span class="sd">        :param X: the first set of inputs to the kernel</span>
<span class="sd">        :param X2: (optional) the second set of arguments to the kernel. If X2</span>
<span class="sd">                   is None, this is passed throgh to the &#39;part&#39; object, which</span>
<span class="sd">                   handLes this as X2 == X.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="Kern.Kdiag"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.Kdiag">[docs]</a>    <span class="k">def</span> <span class="nf">Kdiag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="Kern.psi0"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.psi0">[docs]</a>    <span class="k">def</span> <span class="nf">psi0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">variational_posterior</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="Kern.psi1"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.psi1">[docs]</a>    <span class="k">def</span> <span class="nf">psi1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">variational_posterior</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="Kern.psi2"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.psi2">[docs]</a>    <span class="k">def</span> <span class="nf">psi2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">variational_posterior</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="Kern.gradients_X"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.gradients_X">[docs]</a>    <span class="k">def</span> <span class="nf">gradients_X</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>
<div class="viewcode-block" id="Kern.gradients_X_diag"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.gradients_X_diag">[docs]</a>    <span class="k">def</span> <span class="nf">gradients_X_diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dKdiag</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Kern.update_gradients_diag"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.update_gradients_diag">[docs]</a>    <span class="k">def</span> <span class="nf">update_gradients_diag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dKdiag</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; update the gradients of all parameters when using only the diagonal elements of the covariance matrix&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Kern.update_gradients_full"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.update_gradients_full">[docs]</a>    <span class="k">def</span> <span class="nf">update_gradients_full</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the gradients of all parameters when doing full (N) inference.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Kern.update_gradients_expectations"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.update_gradients_expectations">[docs]</a>    <span class="k">def</span> <span class="nf">update_gradients_expectations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dpsi0</span><span class="p">,</span> <span class="n">dL_dpsi1</span><span class="p">,</span> <span class="n">dL_dpsi2</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">variational_posterior</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the gradients of all parameters when doing inference with</span>
<span class="sd">        uncertain inputs, using expectations of the kernel.</span>

<span class="sd">        The esential maths is</span>

<span class="sd">        dL_d{theta_i} = dL_dpsi0 * dpsi0_d{theta_i} +</span>
<span class="sd">                        dL_dpsi1 * dpsi1_d{theta_i} +</span>
<span class="sd">                        dL_dpsi2 * dpsi2_d{theta_i}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Kern.gradients_Z_expectations"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.gradients_Z_expectations">[docs]</a>    <span class="k">def</span> <span class="nf">gradients_Z_expectations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dpsi0</span><span class="p">,</span> <span class="n">dL_dpsi1</span><span class="p">,</span> <span class="n">dL_dpsi2</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">variational_posterior</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the derivative of the objective wrt Z, using the chain rule</span>
<span class="sd">        through the expectation variables.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Kern.gradients_qX_expectations"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.gradients_qX_expectations">[docs]</a>    <span class="k">def</span> <span class="nf">gradients_qX_expectations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dL_dpsi0</span><span class="p">,</span> <span class="n">dL_dpsi1</span><span class="p">,</span> <span class="n">dL_dpsi2</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">variational_posterior</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the gradients wrt the parameters of the variational</span>
<span class="sd">        distruibution q(X), chain-ruling via the expectations of the kernel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</div>
<div class="viewcode-block" id="Kern.plot"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fignum</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plot_limits</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">mpl_kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        plot this kernel.</span>
<span class="sd">        :param x: the value to use for the other kernel argument (kernels are a function of two variables!)</span>
<span class="sd">        :param fignum: figure number of the plot</span>
<span class="sd">        :param ax: matplotlib axis to plot on</span>
<span class="sd">        :param title: the matplotlib title</span>
<span class="sd">        :param plot_limits: the range over which to plot the kernel</span>
<span class="sd">        :resolution: the resolution of the lines used in plotting</span>
<span class="sd">        :mpl_kwargs avalid keyword arguments to pass through to matplotlib (e.g. lw=7)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="s">&quot;matplotlib&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">,</span> <span class="s">&quot;matplotlib package has not been imported.&quot;</span>
        <span class="kn">from</span> <span class="nn">...plotting.matplot_dep</span> <span class="kn">import</span> <span class="n">kernel_plots</span>
        <span class="n">kernel_plots</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fignum</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">plot_limits</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="o">**</span><span class="n">mpl_kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Kern.plot_ARD"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.plot_ARD">[docs]</a>    <span class="k">def</span> <span class="nf">plot_ARD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        See :class:`~GPy.plotting.matplot_dep.kernel_plots`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">sys</span>
        <span class="k">assert</span> <span class="s">&quot;matplotlib&quot;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">,</span> <span class="s">&quot;matplotlib package has not been imported.&quot;</span>
        <span class="kn">from</span> <span class="nn">...plotting.matplot_dep</span> <span class="kn">import</span> <span class="n">kernel_plots</span>
        <span class="k">return</span> <span class="n">kernel_plots</span><span class="o">.</span><span class="n">plot_ARD</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Kern.input_sensitivity"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.input_sensitivity">[docs]</a>    <span class="k">def</span> <span class="nf">input_sensitivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summarize</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the sensitivity for each dimension of this kernel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Overloading of the &#39;+&#39; operator. for more control, see self.add &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="Kern.add"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;add&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add another kernel to this one.</span>

<span class="sd">        :param other: the other kernel to be added</span>
<span class="sd">        :type other: GPy.kern</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Kern</span><span class="p">),</span> <span class="s">&quot;only kernels can be added to kernels...&quot;</span>
        <span class="kn">from</span> <span class="nn">add</span> <span class="kn">import</span> <span class="n">Add</span>
        <span class="k">return</span> <span class="n">Add</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Here we overload the &#39;*&#39; operator. See self.prod for more information&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Here we overload the &#39;*&#39; operator. See self.prod for more information&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shortcut for tensor `prod`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_dims</span> <span class="o">==</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)),</span> <span class="s">&quot;Can only use kernels, which have their input_dims defined from 0&quot;</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">active_dims</span> <span class="o">==</span> <span class="nb">range</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)),</span> <span class="s">&quot;Can only use kernels, which have their input_dims defined from 0&quot;</span>
        <span class="n">other</span><span class="o">.</span><span class="n">active_dims</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="Kern.prod"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.Kern.prod">[docs]</a>    <span class="k">def</span> <span class="nf">prod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;mul&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Multiply two kernels (either on the same space, or on the tensor</span>
<span class="sd">        product of the input space).</span>

<span class="sd">        :param other: the other kernel to be added</span>
<span class="sd">        :type other: GPy.kern</span>
<span class="sd">        :param tensor: whether or not to use the tensor space (default is false).</span>
<span class="sd">        :type tensor: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Kern</span><span class="p">),</span> <span class="s">&quot;only kernels can be multiplied to kernels...&quot;</span>
        <span class="kn">from</span> <span class="nn">prod</span> <span class="kn">import</span> <span class="n">Prod</span>
        <span class="c">#kernels = []</span>
        <span class="c">#if isinstance(self, Prod): kernels.extend(self.parameters)</span>
        <span class="c">#else: kernels.append(self)</span>
        <span class="c">#if isinstance(other, Prod): kernels.extend(other.parameters)</span>
        <span class="c">#else: kernels.append(other)</span>
        <span class="k">return</span> <span class="n">Prod</span><span class="p">([</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_check_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">,</span> <span class="s">&quot;{} did not specify active_dims and X has wrong shape: X_dim={}, whereas input_dim={}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_active_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_dims</span><span class="p">),</span> <span class="s">&quot;At least {} dimensional X needed, X.shape={!s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">active_dims</span><span class="p">),</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="CombinationKernel"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.CombinationKernel">[docs]</a><span class="k">class</span> <span class="nc">CombinationKernel</span><span class="p">(</span><span class="n">Kern</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract super class for combination kernels.</span>
<span class="sd">    A combination kernel combines (a list of) kernels and works on those.</span>
<span class="sd">    Examples are the HierarchicalKernel or Add and Prod kernels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernels</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">extra_dims</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abstract super class for combination kernels.</span>
<span class="sd">        A combination kernel combines (a list of) kernels and works on those.</span>
<span class="sd">        Examples are the HierarchicalKernel or Add and Prod kernels.</span>

<span class="sd">        :param list kernels: List of kernels to combine (can be only one element)</span>
<span class="sd">        :param str name: name of the combination kernel</span>
<span class="sd">        :param array-like extra_dims: if needed extra dimensions for the combination kernel to work on</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Kern</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kernels</span><span class="p">])</span>
        <span class="n">extra_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">extra_dims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">input_dim</span><span class="p">,</span> <span class="n">active_dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_input_dim_active_dims</span><span class="p">(</span><span class="n">kernels</span><span class="p">,</span> <span class="n">extra_dims</span><span class="p">)</span>
        <span class="c"># initialize the kernel with the full input_dim</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CombinationKernel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">active_dims</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_dims</span> <span class="o">=</span> <span class="n">extra_dims</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_parameters</span><span class="p">(</span><span class="o">*</span><span class="n">kernels</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>

<div class="viewcode-block" id="CombinationKernel.get_input_dim_active_dims"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.CombinationKernel.get_input_dim_active_dims">[docs]</a>    <span class="k">def</span> <span class="nf">get_input_dim_active_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernels</span><span class="p">,</span> <span class="n">extra_dims</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="c">#active_dims = reduce(np.union1d, (np.r_[x.active_dims] for x in kernels), np.array([], dtype=int))</span>
        <span class="c">#active_dims = np.array(np.concatenate((active_dims, extra_dims if extra_dims is not None else [])), dtype=int)</span>
        <span class="n">input_dim</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">active_dims</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kernels</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">extra_dims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">input_dim</span> <span class="o">+=</span> <span class="n">extra_dims</span><span class="o">.</span><span class="n">size</span>

        <span class="n">active_dims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">input_dim</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">active_dims</span>
</div>
<div class="viewcode-block" id="CombinationKernel.input_sensitivity"><a class="viewcode-back" href="../../../../GPy.kern._src.html#GPy.kern._src.kern.CombinationKernel.input_sensitivity">[docs]</a>    <span class="k">def</span> <span class="nf">input_sensitivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summarize</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If summize is true, we want to get the summerized view of the sensitivities,</span>
<span class="sd">        otherwise put everything into an array with shape (#kernels, input_dim)</span>
<span class="sd">        in the order of appearance of the kernels in the parameterized object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;Choose the kernel you want to get the sensitivity for. You need to override the default behaviour for getting the input sensitivity to be able to get the input sensitivity. For sum kernel it is the sum of all sensitivities, TODO: product kernel? Other kernels?, also TODO: shall we return all the sensitivities here in the combination kernel? So we can combine them however we want? This could lead to just plot all the sensitivities here...&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_check_active_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_check_input_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="c"># As combination kernels cannot always know, what their inner kernels have as input dims, the check will be done inside them, respectively</span>
        <span class="k">return</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">GPy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../../GPy.html" >GPy</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>