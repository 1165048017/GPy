<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GPy.testing.kernel_tests &mdash; GPy  documentation</title>
    
    <link rel="stylesheet" href="../../../_static//default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="GPy  documentation" href="../../../index.html" />
    <link rel="up" title="GPy.testing" href="../testing.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">GPy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../GPy.html" >GPy</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="../testing.html" accesskey="U">GPy.testing</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for GPy.testing.kernel_tests</h1><div class="highlight"><pre>
<span class="c"># Copyright (c) 2012, 2013 GPy authors (see AUTHORS.txt).</span>
<span class="c"># Licensed under the BSD 3-clause license (see LICENSE.txt)</span>

<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">GPy</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">GPy.core.parameterization.param</span> <span class="kn">import</span> <span class="n">Param</span>

<span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span>


<div class="viewcode-block" id="Kern_check_model"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_model">[docs]</a><span class="k">class</span> <span class="nc">Kern_check_model</span><span class="p">(</span><span class="n">GPy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a dummy model class used as a base class for checking that the</span>
<span class="sd">    gradients of a given kernel are implemented correctly. It enables</span>
<span class="sd">    checkgrad() to be called independently on a kernel.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dL_dK</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">GPy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;kernel_test_model&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kernel</span><span class="o">==</span><span class="bp">None</span><span class="p">:</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">kernel</span><span class="o">.</span><span class="n">randomize</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">kernel</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dL_dK</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">X2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">dL_dK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dL_dK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X2</span> <span class="o">=</span> <span class="n">X2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dL_dK</span> <span class="o">=</span> <span class="n">dL_dK</span>

<div class="viewcode-block" id="Kern_check_model.is_positive_semi_definite"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_model.is_positive_semi_definite">[docs]</a>    <span class="k">def</span> <span class="nf">is_positive_semi_definite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">real</span><span class="o">&lt;=-</span><span class="mf">1e-10</span><span class="p">):</span>
            <span class="k">print</span> <span class="n">v</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="Kern_check_model.log_likelihood"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_model.log_likelihood">[docs]</a>    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dL_dK</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="Kern_check_dK_dtheta"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dK_dtheta">[docs]</a><span class="k">class</span> <span class="nc">Kern_check_dK_dtheta</span><span class="p">(</span><span class="n">Kern_check_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class allows gradient checks for the gradient of a kernel with</span>
<span class="sd">    respect to parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dL_dK</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Kern_check_model</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span><span class="n">dL_dK</span><span class="o">=</span><span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="n">X2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">)</span>

<div class="viewcode-block" id="Kern_check_dK_dtheta.parameters_changed"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dK_dtheta.parameters_changed">[docs]</a>    <span class="k">def</span> <span class="nf">parameters_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">update_gradients_full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dL_dK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Kern_check_dKdiag_dtheta"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dKdiag_dtheta">[docs]</a><span class="k">class</span> <span class="nc">Kern_check_dKdiag_dtheta</span><span class="p">(</span><span class="n">Kern_check_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class allows gradient checks of the gradient of the diagonal of a</span>
<span class="sd">    kernel with respect to the parameters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dL_dK</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Kern_check_model</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span><span class="n">dL_dK</span><span class="o">=</span><span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="p">)</span>

<div class="viewcode-block" id="Kern_check_dKdiag_dtheta.log_likelihood"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dKdiag_dtheta.log_likelihood">[docs]</a>    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dL_dK</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">Kdiag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Kern_check_dKdiag_dtheta.parameters_changed"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dKdiag_dtheta.parameters_changed">[docs]</a>    <span class="k">def</span> <span class="nf">parameters_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">update_gradients_diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dL_dK</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Kern_check_dK_dX"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dK_dX">[docs]</a><span class="k">class</span> <span class="nc">Kern_check_dK_dX</span><span class="p">(</span><span class="n">Kern_check_model</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class allows gradient checks for the gradient of a kernel with respect to X. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dL_dK</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Kern_check_model</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span><span class="n">dL_dK</span><span class="o">=</span><span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="n">X2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="s">&#39;X&#39;</span><span class="p">,</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_parameter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>

<div class="viewcode-block" id="Kern_check_dK_dX.parameters_changed"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dK_dX.parameters_changed">[docs]</a>    <span class="k">def</span> <span class="nf">parameters_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">gradient</span><span class="p">[:]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">gradients_X</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dL_dK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="Kern_check_dKdiag_dX"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dKdiag_dX">[docs]</a><span class="k">class</span> <span class="nc">Kern_check_dKdiag_dX</span><span class="p">(</span><span class="n">Kern_check_dK_dX</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class allows gradient checks for the gradient of a kernel diagonal with respect to X. &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dL_dK</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">Kern_check_dK_dX</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span><span class="n">dL_dK</span><span class="o">=</span><span class="n">dL_dK</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<div class="viewcode-block" id="Kern_check_dKdiag_dX.log_likelihood"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dKdiag_dX.log_likelihood">[docs]</a>    <span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dL_dK</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">Kdiag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Kern_check_dKdiag_dX.parameters_changed"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Kern_check_dKdiag_dX.parameters_changed">[docs]</a>    <span class="k">def</span> <span class="nf">parameters_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">gradient</span><span class="p">[:]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">kernel</span><span class="o">.</span><span class="n">gradients_X_diag</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dL_dK</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>


</div></div>
<div class="viewcode-block" id="check_kernel_gradient_functions"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.check_kernel_gradient_functions">[docs]</a><span class="k">def</span> <span class="nf">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">output_ind</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fixed_X_dims</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function runs on kernels to check the correctness of their</span>
<span class="sd">    implementation. It checks that the covariance function is positive definite</span>
<span class="sd">    for a randomly generated data set.</span>

<span class="sd">    :param kern: the kernel to be tested.</span>
<span class="sd">    :type kern: GPy.kern.Kernpart</span>
<span class="sd">    :param X: X input values to test the covariance function.</span>
<span class="sd">    :type X: ndarray</span>
<span class="sd">    :param X2: X2 input values to test the covariance function.</span>
<span class="sd">    :type X2: ndarray</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pass_checks</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">X</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">kern</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">X</span><span class="p">[:,</span> <span class="n">output_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">kern</span><span class="o">.</span><span class="n">output_dim</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">X2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">kern</span><span class="o">.</span><span class="n">input_dim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">output_ind</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">X2</span><span class="p">[:,</span> <span class="n">output_ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">kern</span><span class="o">.</span><span class="n">output_dim</span><span class="p">,</span> <span class="n">X2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Checking covariance function is positive definite.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Kern_check_model</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">is_positive_semi_definite</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Check passed.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Positive definite check failed for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; covariance function.&quot;</span><span class="p">)</span>
        <span class="n">pass_checks</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Checking gradients of K(X, X) wrt theta.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Kern_check_dK_dtheta</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Check passed.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Gradient of K(X, X) wrt theta failed for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; covariance function. Gradient values as follows:&quot;</span><span class="p">)</span>
        <span class="n">Kern_check_dK_dtheta</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">pass_checks</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Checking gradients of K(X, X2) wrt theta.&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Kern_check_dK_dtheta</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="n">X2</span><span class="p">)</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Check passed.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Gradient of K(X, X) wrt theta failed for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; covariance function. Gradient values as follows:&quot;</span><span class="p">)</span>
        <span class="n">Kern_check_dK_dtheta</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="n">X2</span><span class="p">)</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">pass_checks</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Checking gradients of Kdiag(X) wrt theta.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Kern_check_dKdiag_dtheta</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
        <span class="n">result</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;update_gradients_diag not implemented for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Check passed.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Gradient of Kdiag(X) wrt theta failed for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; covariance function. Gradient values as follows:&quot;</span><span class="p">)</span>
        <span class="n">Kern_check_dKdiag_dtheta</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">pass_checks</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Checking gradients of K(X, X) wrt X.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">testmodel</span> <span class="o">=</span> <span class="n">Kern_check_dK_dX</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fixed_X_dims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">testmodel</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">fixed_X_dims</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">testmodel</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
        <span class="n">result</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients_X not implemented for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Check passed.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Gradient of K(X, X) wrt X failed for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; covariance function. Gradient values as follows:&quot;</span><span class="p">)</span>
        <span class="n">testmodel</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">ipdb</span><span class="p">;</span><span class="n">ipdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">pass_checks</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Checking gradients of K(X, X2) wrt X.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">testmodel</span> <span class="o">=</span> <span class="n">Kern_check_dK_dX</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="n">X2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fixed_X_dims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">testmodel</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">fixed_X_dims</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">testmodel</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
        <span class="n">result</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients_X not implemented for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Check passed.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Gradient of K(X, X2) wrt X failed for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; covariance function. Gradient values as follows:&quot;</span><span class="p">)</span>
        <span class="n">testmodel</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">pass_checks</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Checking gradients of Kdiag(X) wrt X.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">testmodel</span> <span class="o">=</span> <span class="n">Kern_check_dKdiag_dX</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fixed_X_dims</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">testmodel</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="n">fixed_X_dims</span><span class="p">]</span><span class="o">.</span><span class="n">fix</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">testmodel</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
        <span class="n">result</span><span class="o">=</span><span class="bp">True</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;gradients_X not implemented for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">and</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Check passed.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Gradient of Kdiag(X) wrt X failed for &quot;</span> <span class="o">+</span> <span class="n">kern</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; covariance function. Gradient values as follows:&quot;</span><span class="p">)</span>
        <span class="n">Kern_check_dKdiag_dX</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">)</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">pass_checks</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="n">pass_checks</span>


</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous">[docs]</a><span class="k">class</span> <span class="nc">KernelGradientTestsContinuous</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="KernelGradientTestsContinuous.setUp"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>

        <span class="n">continuous_kerns</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;RBF&#39;</span><span class="p">,</span> <span class="s">&#39;Linear&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernclasses</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">continuous_kerns</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_Matern32"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_Matern32">[docs]</a>    <span class="k">def</span> <span class="nf">test_Matern32</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Matern32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_Prod"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_Prod">[docs]</a>    <span class="k">def</span> <span class="nf">test_Prod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Matern32</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_Prod2"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_Prod2">[docs]</a>    <span class="k">def</span> <span class="nf">test_Prod2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">))</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_Prod3"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_Prod3">[docs]</a>    <span class="k">def</span> <span class="nf">test_Prod3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="o">*</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">))</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_Add"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_Add">[docs]</a>    <span class="k">def</span> <span class="nf">test_Add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Matern32</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">+=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Matern32</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_Add_dims"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_Add_dims">[docs]</a>    <span class="k">def</span> <span class="nf">test_Add_dims</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Matern32</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Matern32</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="c"># assert it runs:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">k</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">,</span> <span class="s">&quot;k.K(X) should run on self.D-1 dimension&quot;</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_Matern52"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_Matern52">[docs]</a>    <span class="k">def</span> <span class="nf">test_Matern52</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Matern52</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_RBF"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_RBF">[docs]</a>    <span class="k">def</span> <span class="nf">test_RBF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_Linear"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_Linear">[docs]</a>    <span class="k">def</span> <span class="nf">test_Linear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelGradientTestsContinuous.test_LinearFull"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelGradientTestsContinuous.test_LinearFull">[docs]</a>    <span class="k">def</span> <span class="nf">test_LinearFull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">LinearFull</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="KernelTestsMiscellaneous"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelTestsMiscellaneous">[docs]</a><span class="k">class</span> <span class="nc">KernelTestsMiscellaneous</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="KernelTestsMiscellaneous.setUp"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelTestsMiscellaneous.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">N</span><span class="p">,</span> <span class="n">D</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">N</span><span class="p">)[:,</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">D</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rbf</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matern</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Matern32</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">9</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sumkern</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rbf</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sumkern</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matern</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sumkern</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="KernelTestsMiscellaneous.test_which_parts"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelTestsMiscellaneous.test_which_parts">[docs]</a>    <span class="k">def</span> <span class="nf">test_which_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sumkern</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">which_parts</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">matern</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">matern</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sumkern</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">which_parts</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rbf</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">rbf</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sumkern</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">which_parts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sumkern</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">rbf</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)))</span>
</div></div>
<div class="viewcode-block" id="KernelTestsNonContinuous"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelTestsNonContinuous">[docs]</a><span class="k">class</span> <span class="nc">KernelTestsNonContinuous</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="KernelTestsNonContinuous.setUp"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelTestsNonContinuous.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">N0</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="mi">9</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">N0</span><span class="o">+</span><span class="n">N1</span><span class="o">+</span><span class="n">N2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random_integers</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">indices</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">indices</span><span class="o">==</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">indices</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="c">#self.X = self.X[self.X[:, -1].argsort(), :]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="n">N0</span><span class="o">+</span><span class="n">N1</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">[:(</span><span class="n">N0</span><span class="o">*</span><span class="mi">2</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">[(</span><span class="n">N0</span><span class="o">*</span><span class="mi">2</span><span class="p">):,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</div>
<div class="viewcode-block" id="KernelTestsNonContinuous.test_IndependentOutputs"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelTestsNonContinuous.test_IndependentOutputs">[docs]</a>    <span class="k">def</span> <span class="nf">test_IndependentOutputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">))</span>
        <span class="n">kern</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">IndependentOutputs</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;ind_single&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">fixed_X_dims</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;rbf1&#39;</span><span class="p">),</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;rbf012&#39;</span><span class="p">),</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;rbf02&#39;</span><span class="p">)]</span>
        <span class="n">kern</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">IndependentOutputs</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;ind_split&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">fixed_X_dims</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="KernelTestsNonContinuous.test_Hierarchical"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelTestsNonContinuous.test_Hierarchical">[docs]</a>    <span class="k">def</span> <span class="nf">test_Hierarchical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;rbf1&#39;</span><span class="p">),</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;rbf2&#39;</span><span class="p">)]</span>
        <span class="n">kern</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">IndependentOutputs</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;ind_split&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">fixed_X_dims</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="KernelTestsNonContinuous.test_ODE_UY"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.KernelTestsNonContinuous.test_ODE_UY">[docs]</a>    <span class="k">def</span> <span class="nf">test_ODE_UY</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">kern</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">ODE_UY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">active_dims</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">])</span>
        <span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">X2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">check_kernel_gradient_functions</span><span class="p">(</span><span class="n">kern</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">X2</span><span class="o">=</span><span class="n">X2</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">fixed_X_dims</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
</div></div>
<div class="viewcode-block" id="Coregionalize_weave_test"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Coregionalize_weave_test">[docs]</a><span class="k">class</span> <span class="nc">Coregionalize_weave_test</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make sure that the coregionalize kernel work with and without weave enabled</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Coregionalize_weave_test.setUp"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Coregionalize_weave_test.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">Coregionalize</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N2</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">N2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Coregionalize_weave_test.test_sym"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Coregionalize_weave_test.test_sym">[docs]</a>    <span class="k">def</span> <span class="nf">test_sym</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dL_dK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">)</span>
        <span class="n">GPy</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">,</span> <span class="s">&#39;True&#39;</span><span class="p">)</span>
        <span class="n">K_weave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">update_gradients_full</span><span class="p">(</span><span class="n">dL_dK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="n">grads_weave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">GPy</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">)</span>
        <span class="n">K_numpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">update_gradients_full</span><span class="p">(</span><span class="n">dL_dK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
        <span class="n">grads_numpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">K_numpy</span><span class="p">,</span> <span class="n">K_weave</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">grads_numpy</span><span class="p">,</span> <span class="n">grads_weave</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Coregionalize_weave_test.test_nonsym"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.kernel_tests.Coregionalize_weave_test.test_nonsym">[docs]</a>    <span class="k">def</span> <span class="nf">test_nonsym</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dL_dK</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N2</span><span class="p">)</span>
        <span class="n">GPy</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">,</span> <span class="s">&#39;True&#39;</span><span class="p">)</span>
        <span class="n">K_weave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">update_gradients_full</span><span class="p">(</span><span class="n">dL_dK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">)</span>
        <span class="n">grads_weave</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">GPy</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">)</span>
        <span class="n">K_numpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">K</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">update_gradients_full</span><span class="p">(</span><span class="n">dL_dK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X2</span><span class="p">)</span>
        <span class="n">grads_numpy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">.</span><span class="n">gradient</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">K_numpy</span><span class="p">,</span> <span class="n">K_weave</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">grads_numpy</span><span class="p">,</span> <span class="n">grads_weave</span><span class="p">))</span>

    <span class="c">#reset the weave state for any other tests</span></div>
    <span class="n">GPy</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;weave&#39;</span><span class="p">,</span> <span class="s">&#39;working&#39;</span><span class="p">,</span> <span class="s">&#39;False&#39;</span><span class="p">)</span>



</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Running unit tests, please be (very) patient...&quot;</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
<span class="c">#     np.random.seed(0)</span>
<span class="c">#     N0 = 3</span>
<span class="c">#     N1 = 9</span>
<span class="c">#     N2 = 4</span>
<span class="c">#     N = N0+N1+N2</span>
<span class="c">#     D = 3</span>
<span class="c">#     X = np.random.randn(N, D+1)</span>
<span class="c">#     indices = np.random.random_integers(0, 2, size=N)</span>
<span class="c">#     X[indices==0, -1] = 0</span>
<span class="c">#     X[indices==1, -1] = 1</span>
<span class="c">#     X[indices==2, -1] = 2</span>
<span class="c">#     #X = X[X[:, -1].argsort(), :]</span>
<span class="c">#     X2 = np.random.randn((N0+N1)*2, D+1)</span>
<span class="c">#     X2[:(N0*2), -1] = 0</span>
<span class="c">#     X2[(N0*2):, -1] = 1</span>
<span class="c">#     k = [GPy.kern.RBF(1, active_dims=[1], name=&#39;rbf1&#39;), GPy.kern.RBF(D, name=&#39;rbf012&#39;), GPy.kern.RBF(2, active_dims=[0,2], name=&#39;rbf02&#39;)]</span>
<span class="c">#     kern = GPy.kern.IndependentOutputs(k, -1, name=&#39;ind_split&#39;)</span>
<span class="c">#     assert(check_kernel_gradient_functions(kern, X=X, X2=X2, verbose=verbose, fixed_X_dims=-1))</span>
<span class="c">#     k = GPy.kern.RBF(D)</span>
<span class="c">#     kern = GPy.kern.IndependentOutputs(k, -1, &#39;ind_single&#39;)</span>
<span class="c">#     assert(check_kernel_gradient_functions(kern, X=X, X2=X2, verbose=verbose, fixed_X_dims=-1))</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">GPy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../GPy.html" >GPy</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="../testing.html" >GPy.testing</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>