<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GPy.testing.likelihood_tests &mdash; GPy  documentation</title>
    
    <link rel="stylesheet" href="../../../_static//default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="GPy  documentation" href="../../../index.html" />
    <link rel="up" title="GPy.testing" href="../testing.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">GPy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../GPy.html" >GPy</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="../testing.html" accesskey="U">GPy.testing</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for GPy.testing.likelihood_tests</h1><div class="highlight"><pre>
<span class="c"># Copyright (c) 2014, Alan Saul</span>
<span class="c"># Licensed under the BSD 3-clause license (see LICENSE.txt)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">GPy</span>
<span class="kn">from</span> <span class="nn">GPy.models</span> <span class="kn">import</span> <span class="n">GradientChecker</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">GPy.likelihoods</span> <span class="kn">import</span> <span class="n">link_functions</span>
<span class="kn">from</span> <span class="nn">GPy.core.parameterization</span> <span class="kn">import</span> <span class="n">Param</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="c">#np.random.seed(300)</span>
<span class="c">#np.random.seed(7)</span>

<span class="c">#np.seterr(divide=&#39;raise&#39;)</span>
<div class="viewcode-block" id="dparam_partial"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.dparam_partial">[docs]</a><span class="k">def</span> <span class="nf">dparam_partial</span><span class="p">(</span><span class="n">inst_func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If we have a instance method that needs to be called but that doesn&#39;t</span>
<span class="sd">    take the parameter we wish to change to checkgrad, then this function</span>
<span class="sd">    will change the variable using set params.</span>

<span class="sd">    inst_func: should be a instance function of an object that we would like</span>
<span class="sd">                to change</span>
<span class="sd">    param: the param that will be given to set_params</span>
<span class="sd">    args: anything else that needs to be given to the function (for example</span>
<span class="sd">          the f or Y that are being used in the function whilst we tweak the</span>
<span class="sd">          param</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">param_func</span><span class="p">(</span><span class="n">param_val</span><span class="p">,</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">inst_func</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c">#inst_func.im_self._set_params(param)</span>
        <span class="c">#inst_func.im_self.add_parameter(Param(param_name, param_val))</span>
        <span class="n">inst_func</span><span class="o">.</span><span class="n">im_self</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_val</span>
        <span class="k">return</span> <span class="n">inst_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">param_func</span><span class="p">,</span> <span class="n">inst_func</span><span class="o">=</span><span class="n">inst_func</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="dparam_checkgrad"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.dparam_checkgrad">[docs]</a><span class="k">def</span> <span class="nf">dparam_checkgrad</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">dfunc</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">randomize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    checkgrad expects a f: R^N -&gt; R^1 and df: R^N -&gt; R^N</span>
<span class="sd">    However if we are holding other parameters fixed and moving something else</span>
<span class="sd">    We need to check the gradient of each of the fixed parameters</span>
<span class="sd">    (f and y for example) seperately,  whilst moving another parameter.</span>
<span class="sd">    Otherwise f: gives back R^N and</span>
<span class="sd">              df: gives back R^NxM where M is</span>
<span class="sd">    The number of parameters and N is the number of data</span>
<span class="sd">    Need to take a slice out from f and a slice out of df</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{} likelihood: {} vs {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">im_self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span>
                                           <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">dfunc</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
    <span class="n">partial_f</span> <span class="o">=</span> <span class="n">dparam_partial</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">partial_df</span> <span class="o">=</span> <span class="n">dparam_partial</span><span class="p">(</span><span class="n">dfunc</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">gradchecking</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">zipped_params</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">params_names</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">param_ind</span><span class="p">,</span> <span class="p">(</span><span class="n">param_val</span><span class="p">,</span> <span class="n">param_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">zipped_params</span><span class="p">):</span>
        <span class="c">#Check one parameter at a time, make sure it is 2d (as some gradients only return arrays) then strip out the parameter</span>
        <span class="n">fnum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">partial_f</span><span class="p">(</span><span class="n">param_val</span><span class="p">,</span> <span class="n">param_name</span><span class="p">))[:,</span> <span class="n">param_ind</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dfnum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">partial_df</span><span class="p">(</span><span class="n">param_val</span><span class="p">,</span> <span class="n">param_name</span><span class="p">))[:,</span> <span class="n">param_ind</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">fixed_val</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dfnum</span><span class="p">):</span>
            <span class="c">#dlik and dlik_dvar gives back 1 value for each</span>
            <span class="n">f_ind</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">fnum</span><span class="p">,</span> <span class="n">fixed_val</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">print</span> <span class="s">&quot;fnum: {} dfnum: {} f_ind: {} fixed_val: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fnum</span><span class="p">,</span> <span class="n">dfnum</span><span class="p">,</span> <span class="n">f_ind</span><span class="p">,</span> <span class="n">fixed_val</span><span class="p">)</span>
            <span class="c">#Make grad checker with this param moving, note that set_params is NOT being called</span>
            <span class="c">#The parameter is being set directly with __setattr__</span>
            <span class="c">#Check only the parameter and function value we wish to check at a time</span>
            <span class="n">grad</span> <span class="o">=</span> <span class="n">GradientChecker</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p_val</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">partial_f</span><span class="p">(</span><span class="n">p_val</span><span class="p">,</span> <span class="n">param_name</span><span class="p">))[</span><span class="n">f_ind</span><span class="p">,</span> <span class="n">param_ind</span><span class="p">],</span>
                                   <span class="k">lambda</span> <span class="n">p_val</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">partial_df</span><span class="p">(</span><span class="n">p_val</span><span class="p">,</span> <span class="n">param_name</span><span class="p">))[</span><span class="n">fixed_val</span><span class="p">,</span> <span class="n">param_ind</span><span class="p">],</span>
                                   <span class="n">param_val</span><span class="p">,</span> <span class="p">[</span><span class="n">param_name</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">constrain_param</span><span class="p">,</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">grad</span><span class="o">.</span><span class="n">grep_param_names</span><span class="p">(</span><span class="n">constrain_param</span><span class="p">):</span>
                        <span class="n">constraint</span><span class="p">(</span><span class="n">constrain_param</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&quot;parameter didn&#39;t exist&quot;</span>
                    <span class="k">print</span> <span class="n">constrain_param</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">,</span> <span class="n">constraint</span>
            <span class="k">if</span> <span class="n">randomize</span><span class="p">:</span>
                <span class="n">grad</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">grad</span>
                <span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
                <span class="n">gradchecking</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="n">gradchecking</span>

</div>
<span class="kn">from</span> <span class="nn">nose.tools</span> <span class="kn">import</span> <span class="n">with_setup</span>
<div class="viewcode-block" id="TestNoiseModels"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels">[docs]</a><span class="k">class</span> <span class="nc">TestNoiseModels</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generic model checker</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TestNoiseModels.setUp"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">real_std</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">real_std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binary_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positive_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integer_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="mf">0.2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c">#Make a bigger step as lower bound can be quite curved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="mf">1e-4</span>
</div>
<div class="viewcode-block" id="TestNoiseModels.tearDown"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="TestNoiseModels.test_scale2_models"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.test_scale2_models">[docs]</a>    <span class="k">def</span> <span class="nf">test_scale2_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

        <span class="c">####################################################</span>
        <span class="c"># Constraint wrappers so we can just list them off #</span>
        <span class="c">####################################################</span>
        <span class="k">def</span> <span class="nf">constrain_fixed</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
            <span class="n">model</span><span class="p">[</span><span class="n">regex</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_fixed</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">constrain_negative</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
            <span class="n">model</span><span class="p">[</span><span class="n">regex</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_negative</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">constrain_positive</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
            <span class="n">model</span><span class="p">[</span><span class="n">regex</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_positive</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">constrain_bounded</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Used like: partial(constrain_bounded, lower=0, upper=1)</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">model</span><span class="p">[</span><span class="n">regex</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_bounded</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>

        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary where we nest models we would like to check</span>
<span class="sd">            Name: {</span>
<span class="sd">                &quot;model&quot;: model_instance,</span>
<span class="sd">                &quot;grad_params&quot;: {</span>
<span class="sd">                    &quot;names&quot;: [names_of_params_we_want, to_grad_check],</span>
<span class="sd">                    &quot;vals&quot;: [values_of_params, to_start_at],</span>
<span class="sd">                    &quot;constrain&quot;: [constraint_wrappers, listed_here]</span>
<span class="sd">                    },</span>
<span class="sd">                &quot;laplace&quot;: boolean_of_whether_model_should_work_for_laplace,</span>
<span class="sd">                &quot;ep&quot;: boolean_of_whether_model_should_work_for_laplace,</span>
<span class="sd">                &quot;link_f_constraints&quot;: [constraint_wrappers, listed_here]</span>
<span class="sd">                }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">noise_models</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Student_t_default&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="n">deg_free</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">),</span>
                            <span class="s">&quot;grad_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">],</span>
                                <span class="s">&quot;vals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">],</span>
                                <span class="s">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">,</span> <span class="n">constrain_positive</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;.*deg_free&quot;</span><span class="p">,</span> <span class="n">constrain_fixed</span><span class="p">)]</span>
                                <span class="c">#&quot;constraints&quot;: [(&quot;t_scale2&quot;, constrain_positive), (&quot;deg_free&quot;, partial(constrain_fixed, value=5))]</span>
                                <span class="p">},</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span>
                            <span class="p">},</span>
                        <span class="s">&quot;Student_t_1_var&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="n">deg_free</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">),</span>
                            <span class="s">&quot;grad_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">],</span>
                                <span class="s">&quot;vals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span>
                                <span class="s">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">,</span> <span class="n">constrain_positive</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;.*deg_free&quot;</span><span class="p">,</span> <span class="n">constrain_fixed</span><span class="p">)]</span>
                                <span class="p">},</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span>
                            <span class="p">},</span>
                        <span class="s">&quot;Student_t_small_deg_free&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="n">deg_free</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">),</span>
                            <span class="s">&quot;grad_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">],</span>
                                <span class="s">&quot;vals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">],</span>
                                <span class="s">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">,</span> <span class="n">constrain_positive</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;.*deg_free&quot;</span><span class="p">,</span> <span class="n">constrain_fixed</span><span class="p">)]</span>
                                <span class="p">},</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span>
                            <span class="p">},</span>
                        <span class="s">&quot;Student_t_small_var&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="n">deg_free</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">),</span>
                            <span class="s">&quot;grad_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">],</span>
                                <span class="s">&quot;vals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">],</span>
                                <span class="s">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">,</span> <span class="n">constrain_positive</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;.*deg_free&quot;</span><span class="p">,</span> <span class="n">constrain_fixed</span><span class="p">)]</span>
                                <span class="p">},</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span>
                            <span class="p">},</span>
                        <span class="s">&quot;Student_t_large_var&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="n">deg_free</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">),</span>
                            <span class="s">&quot;grad_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">],</span>
                                <span class="s">&quot;vals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">],</span>
                                <span class="s">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">,</span> <span class="n">constrain_positive</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;.*deg_free&quot;</span><span class="p">,</span> <span class="n">constrain_fixed</span><span class="p">)]</span>
                                <span class="p">},</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span>
                            <span class="p">},</span>
                        <span class="s">&quot;Student_t_approx_gauss&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="n">deg_free</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">),</span>
                            <span class="s">&quot;grad_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">],</span>
                                <span class="s">&quot;vals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">],</span>
                                <span class="s">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">,</span> <span class="n">constrain_positive</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;.*deg_free&quot;</span><span class="p">,</span> <span class="n">constrain_fixed</span><span class="p">)]</span>
                                <span class="p">},</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span>
                            <span class="p">},</span>
                        <span class="s">&quot;Student_t_log&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="n">gp_link</span><span class="o">=</span><span class="n">link_functions</span><span class="o">.</span><span class="n">Log</span><span class="p">(),</span> <span class="n">deg_free</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">),</span>
                            <span class="s">&quot;grad_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">],</span>
                                <span class="s">&quot;vals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">],</span>
                                <span class="s">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s">&quot;.*t_scale2&quot;</span><span class="p">,</span> <span class="n">constrain_positive</span><span class="p">),</span> <span class="p">(</span><span class="s">&quot;.*deg_free&quot;</span><span class="p">,</span> <span class="n">constrain_fixed</span><span class="p">)]</span>
                                <span class="p">},</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span>
                            <span class="p">},</span>
                        <span class="s">&quot;Gaussian_default&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">variance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">),</span>
                            <span class="s">&quot;grad_params&quot;</span><span class="p">:</span> <span class="p">{</span>
                                <span class="s">&quot;names&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;.*variance&quot;</span><span class="p">],</span>
                                <span class="s">&quot;vals&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">],</span>
                                <span class="s">&quot;constraints&quot;</span><span class="p">:</span> <span class="p">[(</span><span class="s">&quot;.*variance&quot;</span><span class="p">,</span> <span class="n">constrain_positive</span><span class="p">)]</span>
                                <span class="p">},</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="s">&quot;ep&quot;</span><span class="p">:</span> <span class="bp">False</span> <span class="c"># FIXME: Should be True when we have it working again</span>
                            <span class="p">},</span>
                        <span class="c">#&quot;Gaussian_log&quot;: {</span>
                            <span class="c">#&quot;model&quot;: GPy.likelihoods.gaussian(gp_link=link_functions.Log(), variance=self.var, D=self.D, N=self.N),</span>
                            <span class="c">#&quot;grad_params&quot;: {</span>
                                <span class="c">#&quot;names&quot;: [&quot;noise_model_variance&quot;],</span>
                                <span class="c">#&quot;vals&quot;: [self.var],</span>
                                <span class="c">#&quot;constraints&quot;: [constrain_positive]</span>
                                <span class="c">#},</span>
                            <span class="c">#&quot;laplace&quot;: True</span>
                            <span class="c">#},</span>
                        <span class="c">#&quot;Gaussian_probit&quot;: {</span>
                            <span class="c">#&quot;model&quot;: GPy.likelihoods.gaussian(gp_link=link_functions.Probit(), variance=self.var, D=self.D, N=self.N),</span>
                            <span class="c">#&quot;grad_params&quot;: {</span>
                                <span class="c">#&quot;names&quot;: [&quot;noise_model_variance&quot;],</span>
                                <span class="c">#&quot;vals&quot;: [self.var],</span>
                                <span class="c">#&quot;constraints&quot;: [constrain_positive]</span>
                                <span class="c">#},</span>
                            <span class="c">#&quot;laplace&quot;: True</span>
                            <span class="c">#},</span>
                        <span class="c">#&quot;Gaussian_log_ex&quot;: {</span>
                            <span class="c">#&quot;model&quot;: GPy.likelihoods.gaussian(gp_link=link_functions.Log_ex_1(), variance=self.var, D=self.D, N=self.N),</span>
                            <span class="c">#&quot;grad_params&quot;: {</span>
                                <span class="c">#&quot;names&quot;: [&quot;noise_model_variance&quot;],</span>
                                <span class="c">#&quot;vals&quot;: [self.var],</span>
                                <span class="c">#&quot;constraints&quot;: [constrain_positive]</span>
                                <span class="c">#},</span>
                            <span class="c">#&quot;laplace&quot;: True</span>
                            <span class="c">#},</span>
                        <span class="s">&quot;Bernoulli_default&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">Bernoulli</span><span class="p">(),</span>
                            <span class="s">&quot;link_f_constraints&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">partial</span><span class="p">(</span><span class="n">constrain_bounded</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="s">&quot;Y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_Y</span><span class="p">,</span>
                            <span class="s">&quot;ep&quot;</span><span class="p">:</span> <span class="bp">False</span> <span class="c"># FIXME: Should be True when we have it working again</span>
                            <span class="p">},</span>
                        <span class="s">&quot;Exponential_default&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">Exponential</span><span class="p">(),</span>
                            <span class="s">&quot;link_f_constraints&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">constrain_positive</span><span class="p">],</span>
                            <span class="s">&quot;Y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">positive_Y</span><span class="p">,</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s">&quot;Poisson_default&quot;</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s">&quot;model&quot;</span><span class="p">:</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">Poisson</span><span class="p">(),</span>
                            <span class="s">&quot;link_f_constraints&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">constrain_positive</span><span class="p">],</span>
                            <span class="s">&quot;Y&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">integer_Y</span><span class="p">,</span>
                            <span class="s">&quot;laplace&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="s">&quot;ep&quot;</span><span class="p">:</span> <span class="bp">False</span> <span class="c">#Should work though...</span>
                        <span class="p">}</span><span class="c">#,</span>
                        <span class="c">#GAMMA needs some work!&quot;Gamma_default&quot;: {</span>
                            <span class="c">#&quot;model&quot;: GPy.likelihoods.Gamma(),</span>
                            <span class="c">#&quot;link_f_constraints&quot;: [constrain_positive],</span>
                            <span class="c">#&quot;Y&quot;: self.positive_Y,</span>
                            <span class="c">#&quot;laplace&quot;: True</span>
                        <span class="c">#}</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">attributes</span> <span class="ow">in</span> <span class="n">noise_models</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;model&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&quot;grad_params&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;grad_params&quot;</span><span class="p">]</span>
                <span class="n">param_vals</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&quot;vals&quot;</span><span class="p">]</span>
                <span class="n">param_names</span><span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&quot;names&quot;</span><span class="p">]</span>
                <span class="n">param_constraints</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s">&quot;constraints&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">param_vals</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">param_names</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">constrain_positive</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">param_constraints</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># ??? TODO: Saul to Fix.</span>
            <span class="k">if</span> <span class="s">&quot;link_f_constraints&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="n">link_f_constraints</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;link_f_constraints&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">link_f_constraints</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s">&quot;Y&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;Y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">&quot;f&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;f&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">&quot;laplace&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="n">laplace</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;laplace&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">laplace</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="s">&quot;ep&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
                <span class="n">ep</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s">&quot;ep&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ep</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c">#if len(param_vals) &gt; 1:</span>
                <span class="c">#raise NotImplementedError(&quot;Cannot support multiple params in likelihood yet!&quot;)</span>

            <span class="c">#Required by all</span>
            <span class="c">#Normal derivatives</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_logpdf</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_dlogpdf_df</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_d2logpdf_df2</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span>
            <span class="c">#Link derivatives</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_dlogpdf_dlink</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">link_f_constraints</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_d2logpdf_dlink2</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">link_f_constraints</span>
            <span class="k">if</span> <span class="n">laplace</span><span class="p">:</span>
                <span class="c">#Laplace only derivatives</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_d3logpdf_df3</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_d3logpdf_dlink3</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">link_f_constraints</span>
                <span class="c">#Params</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_dlogpdf_dparams</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_dlogpdf_df_dparams</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_d2logpdf2_df2_dparams</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span>
                <span class="c">#Link params</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_dlogpdf_link_dparams</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_dlogpdf_dlink_dparams</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_d2logpdf2_dlink2_dparams</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span>

                <span class="c">#laplace likelihood gradcheck</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_laplace_fit_rbf_white</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span>
            <span class="k">if</span> <span class="n">ep</span><span class="p">:</span>
                <span class="c">#ep likelihood gradcheck</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_ep_fit_rbf_white</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">tearDown</span><span class="p">()</span>

    <span class="c">#############</span>
    <span class="c"># dpdf_df&#39;s #</span>
    <span class="c">#############</span></div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_logpdf"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_logpdf">[docs]</a>    <span class="k">def</span> <span class="nf">t_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="c">#print model._get_params()</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span>
                <span class="n">model</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span><span class="o">.</span><span class="n">prod</span><span class="p">(),</span>
                               <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
                               <span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_dlogpdf_df"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_dlogpdf_df">[docs]</a>    <span class="k">def</span> <span class="nf">t_dlogpdf_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">logpdf</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">logpdf</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">dlogpdf_df</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">GradientChecker</span><span class="p">(</span><span class="n">logpdf</span><span class="p">,</span> <span class="n">dlogpdf_df</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">grad</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_d2logpdf_df2"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_d2logpdf_df2">[docs]</a>    <span class="k">def</span> <span class="nf">t_d2logpdf_df2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">dlogpdf_df</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">d2logpdf_df2</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">d2logpdf_df2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">GradientChecker</span><span class="p">(</span><span class="n">dlogpdf_df</span><span class="p">,</span> <span class="n">d2logpdf_df2</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">grad</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_d3logpdf_df3"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_d3logpdf_df3">[docs]</a>    <span class="k">def</span> <span class="nf">t_d3logpdf_df3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">d2logpdf_df2</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">d2logpdf_df2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">d3logpdf_df3</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">d3logpdf_df3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">GradientChecker</span><span class="p">(</span><span class="n">d2logpdf_df2</span><span class="p">,</span> <span class="n">d3logpdf_df3</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">grad</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c">##############</span>
    <span class="c"># df_dparams #</span>
    <span class="c">##############</span></div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_dlogpdf_dparams"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_dlogpdf_dparams">[docs]</a>    <span class="k">def</span> <span class="nf">t_dlogpdf_dparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">param_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">dparam_checkgrad</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">logpdf</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_dtheta</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">constraints</span><span class="o">=</span><span class="n">param_constraints</span><span class="p">,</span>
                    <span class="n">randomize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_dlogpdf_df_dparams"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_dlogpdf_df_dparams">[docs]</a>    <span class="k">def</span> <span class="nf">t_dlogpdf_df_dparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">param_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">dparam_checkgrad</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_df</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_df_dtheta</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">constraints</span><span class="o">=</span><span class="n">param_constraints</span><span class="p">,</span>
                    <span class="n">randomize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_d2logpdf2_df2_dparams"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_d2logpdf2_df2_dparams">[docs]</a>    <span class="k">def</span> <span class="nf">t_d2logpdf2_df2_dparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">param_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">dparam_checkgrad</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">d2logpdf_df2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">d2logpdf_df2_dtheta</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">,</span> <span class="n">params_names</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">constraints</span><span class="o">=</span><span class="n">param_constraints</span><span class="p">,</span>
                    <span class="n">randomize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="c">################</span>
    <span class="c"># dpdf_dlink&#39;s #</span>
    <span class="c">################</span></div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_dlogpdf_dlink"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_dlogpdf_dlink">[docs]</a>    <span class="k">def</span> <span class="nf">t_dlogpdf_dlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">link_f_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">logpdf</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">logpdf_link</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">dlogpdf_dlink</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_dlink</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">GradientChecker</span><span class="p">(</span><span class="n">logpdf</span><span class="p">,</span> <span class="n">dlogpdf_dlink</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s">&#39;g&#39;</span><span class="p">)</span>

        <span class="c">#Apply constraints to link_f values</span>
        <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">link_f_constraints</span><span class="p">:</span>
            <span class="n">constraint</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>

        <span class="n">grad</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">grad</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_d2logpdf_dlink2"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_d2logpdf_dlink2">[docs]</a>    <span class="k">def</span> <span class="nf">t_d2logpdf_dlink2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">link_f_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">dlogpdf_dlink</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_dlink</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">d2logpdf_dlink2</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">d2logpdf_dlink2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">GradientChecker</span><span class="p">(</span><span class="n">dlogpdf_dlink</span><span class="p">,</span> <span class="n">d2logpdf_dlink2</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s">&#39;g&#39;</span><span class="p">)</span>

        <span class="c">#Apply constraints to link_f values</span>
        <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">link_f_constraints</span><span class="p">:</span>
            <span class="n">constraint</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>

        <span class="n">grad</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">grad</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_d3logpdf_dlink3"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_d3logpdf_dlink3">[docs]</a>    <span class="k">def</span> <span class="nf">t_d3logpdf_dlink3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">link_f_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">d2logpdf_dlink2</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">d2logpdf_dlink2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">d3logpdf_dlink3</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">d3logpdf_dlink3</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">GradientChecker</span><span class="p">(</span><span class="n">d2logpdf_dlink2</span><span class="p">,</span> <span class="n">d3logpdf_dlink3</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s">&#39;g&#39;</span><span class="p">)</span>

        <span class="c">#Apply constraints to link_f values</span>
        <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">link_f_constraints</span><span class="p">:</span>
            <span class="n">constraint</span><span class="p">(</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">grad</span><span class="p">)</span>

        <span class="n">grad</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">grad</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c">#################</span>
    <span class="c"># dlink_dparams #</span>
    <span class="c">#################</span></div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_dlogpdf_link_dparams"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_dlogpdf_link_dparams">[docs]</a>    <span class="k">def</span> <span class="nf">t_dlogpdf_link_dparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">dparam_checkgrad</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">logpdf_link</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_link_dtheta</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">constraints</span><span class="o">=</span><span class="n">param_constraints</span><span class="p">,</span>
                    <span class="n">randomize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_dlogpdf_dlink_dparams"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_dlogpdf_dlink_dparams">[docs]</a>    <span class="k">def</span> <span class="nf">t_dlogpdf_dlink_dparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">dparam_checkgrad</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_dlink</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">dlogpdf_dlink_dtheta</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">constraints</span><span class="o">=</span><span class="n">param_constraints</span><span class="p">,</span>
                    <span class="n">randomize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="p">)</span>
</div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_d2logpdf2_dlink2_dparams"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_d2logpdf2_dlink2_dparams">[docs]</a>    <span class="k">def</span> <span class="nf">t_d2logpdf2_dlink2_dparams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">param_constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="n">model</span>
        <span class="k">assert</span> <span class="p">(</span>
                <span class="n">dparam_checkgrad</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">d2logpdf_dlink2</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">d2logpdf_dlink2_dtheta</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">constraints</span><span class="o">=</span><span class="n">param_constraints</span><span class="p">,</span>
                    <span class="n">randomize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="p">)</span>

    <span class="c">################</span>
    <span class="c"># laplace test #</span>
    <span class="c">################</span></div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_laplace_fit_rbf_white"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_laplace_fit_rbf_white">[docs]</a>    <span class="k">def</span> <span class="nf">t_laplace_fit_rbf_white</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="c">#Normalize</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">/</span><span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">white_var</span> <span class="o">=</span> <span class="mf">1e-6</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">White</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">laplace_likelihood</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">latent_function_inference</span><span class="o">.</span><span class="n">Laplace</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">GP</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">likelihood</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_method</span><span class="o">=</span><span class="n">laplace_likelihood</span><span class="p">)</span>
        <span class="n">m</span><span class="p">[</span><span class="s">&#39;.*white&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_fixed</span><span class="p">(</span><span class="n">white_var</span><span class="p">)</span>

        <span class="c">#Set constraints</span>
        <span class="k">for</span> <span class="n">constrain_param</span><span class="p">,</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="n">constraints</span><span class="p">:</span>
            <span class="n">constraint</span><span class="p">(</span><span class="n">constrain_param</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

        <span class="k">print</span> <span class="n">m</span>
        <span class="n">m</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>

        <span class="c">#Set params</span>
        <span class="k">for</span> <span class="n">param_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">param_names</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">param_names</span><span class="p">[</span><span class="n">param_num</span><span class="p">]</span>
            <span class="n">m</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_vals</span><span class="p">[</span><span class="n">param_num</span><span class="p">]</span>

        <span class="c">#m.optimize(max_iters=8)</span>
        <span class="k">print</span> <span class="n">m</span>
        <span class="c">#if not m.checkgrad(step=step):</span>
            <span class="c">#m.checkgrad(verbose=1, step=step)</span>
            <span class="c">#NOTE this test appears to be stochastic for some likelihoods (student t?)</span>
            <span class="c"># appears to all be working in test mode right now...</span>
        <span class="c">#if isinstance(model, GPy.likelihoods.StudentT):</span>
        <span class="k">assert</span> <span class="n">m</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>

    <span class="c">###########</span>
    <span class="c"># EP test #</span>
    <span class="c">###########</span></div>
    <span class="nd">@with_setup</span><span class="p">(</span><span class="n">setUp</span><span class="p">,</span> <span class="n">tearDown</span><span class="p">)</span>
<div class="viewcode-block" id="TestNoiseModels.t_ep_fit_rbf_white"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.TestNoiseModels.t_ep_fit_rbf_white">[docs]</a>    <span class="k">def</span> <span class="nf">t_ep_fit_rbf_white</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">,</span> <span class="n">param_names</span><span class="p">,</span> <span class="n">constraints</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="c">#Normalize</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">/</span><span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">white_var</span> <span class="o">=</span> <span class="mf">1e-6</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">White</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ep_inf</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">latent_function_inference</span><span class="o">.</span><span class="n">EP</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">GP</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">likelihood</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">inference_method</span><span class="o">=</span><span class="n">ep_inf</span><span class="p">)</span>
        <span class="n">m</span><span class="p">[</span><span class="s">&#39;.*white&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_fixed</span><span class="p">(</span><span class="n">white_var</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">param_num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">param_names</span><span class="p">)):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">param_names</span><span class="p">[</span><span class="n">param_num</span><span class="p">]</span>
            <span class="n">m</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_vals</span><span class="p">[</span><span class="n">param_num</span><span class="p">]</span>
            <span class="n">constraints</span><span class="p">[</span><span class="n">param_num</span><span class="p">](</span><span class="n">name</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

        <span class="n">m</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">m</span>
        <span class="k">assert</span> <span class="n">m</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="LaplaceTests"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.LaplaceTests">[docs]</a><span class="k">class</span> <span class="nc">LaplaceTests</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specific likelihood tests, not general enough for the above tests</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="LaplaceTests.setUp"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.LaplaceTests.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">real_std</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">real_std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="mf">0.2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stu_t</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="n">deg_free</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">sigma2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>
        <span class="c">#TODO: gaussians with on Identity link. self.gauss = GPy.likelihoods.Gaussian(gp_link=link_functions.Log(), variance=self.var)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">variance</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">)</span>

        <span class="c">#Make a bigger step as lower bound can be quite curved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="mf">1e-6</span>
</div>
<div class="viewcode-block" id="LaplaceTests.tearDown"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.LaplaceTests.tearDown">[docs]</a>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stu_t</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gauss</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="LaplaceTests.test_gaussian_d2logpdf_df2_2"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.LaplaceTests.test_gaussian_d2logpdf_df2_2">[docs]</a>    <span class="k">def</span> <span class="nf">test_gaussian_d2logpdf_df2_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">real_std</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">real_std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">X</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">noise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">dlogpdf_df</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gauss</span><span class="o">.</span><span class="n">dlogpdf_df</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">d2logpdf_df2</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gauss</span><span class="o">.</span><span class="n">d2logpdf_df2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="n">GradientChecker</span><span class="p">(</span><span class="n">dlogpdf_df</span><span class="p">,</span> <span class="n">d2logpdf_df2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="s">&#39;g&#39;</span><span class="p">)</span>
        <span class="n">grad</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">grad</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="LaplaceTests.test_laplace_log_likelihood"><a class="viewcode-back" href="../../../GPy.testing.html#GPy.testing.likelihood_tests.LaplaceTests.test_laplace_log_likelihood">[docs]</a>    <span class="k">def</span> <span class="nf">test_laplace_log_likelihood</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">debug</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">real_std</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">initial_var_guess</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="c">#Start a function, any function</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">*</span><span class="n">real_std</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span><span class="o">/</span><span class="n">Y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="c">#Yc = Y.copy()</span>
        <span class="c">#Yc[75:80] += 1</span>
        <span class="n">kernel1</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">White</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c">#FIXME: Make sure you can copy kernels when params is fixed</span>
        <span class="c">#kernel2 = kernel1.copy()</span>
        <span class="n">kernel2</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">RBF</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">GPy</span><span class="o">.</span><span class="n">kern</span><span class="o">.</span><span class="n">White</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">gauss_distr1</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">variance</span><span class="o">=</span><span class="n">initial_var_guess</span><span class="p">)</span>
        <span class="n">exact_inf</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">latent_function_inference</span><span class="o">.</span><span class="n">ExactGaussianInference</span><span class="p">()</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">GP</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel1</span><span class="p">,</span> <span class="n">likelihood</span><span class="o">=</span><span class="n">gauss_distr1</span><span class="p">,</span> <span class="n">inference_method</span><span class="o">=</span><span class="n">exact_inf</span><span class="p">)</span>
        <span class="n">m1</span><span class="p">[</span><span class="s">&#39;.*white&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_fixed</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
        <span class="n">m1</span><span class="p">[</span><span class="s">&#39;.*rbf.variance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial_var_guess</span>
        <span class="n">m1</span><span class="p">[</span><span class="s">&#39;.*rbf.variance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_bounded</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">m1</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>

        <span class="n">gauss_distr2</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">likelihoods</span><span class="o">.</span><span class="n">Gaussian</span><span class="p">(</span><span class="n">variance</span><span class="o">=</span><span class="n">initial_var_guess</span><span class="p">)</span>
        <span class="n">laplace_inf</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">inference</span><span class="o">.</span><span class="n">latent_function_inference</span><span class="o">.</span><span class="n">Laplace</span><span class="p">()</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">GPy</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">GP</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">kernel</span><span class="o">=</span><span class="n">kernel2</span><span class="p">,</span> <span class="n">likelihood</span><span class="o">=</span><span class="n">gauss_distr2</span><span class="p">,</span> <span class="n">inference_method</span><span class="o">=</span><span class="n">laplace_inf</span><span class="p">)</span>
        <span class="n">m2</span><span class="p">[</span><span class="s">&#39;.*white&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_fixed</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
        <span class="n">m2</span><span class="p">[</span><span class="s">&#39;.*rbf.variance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">constrain_bounded</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">m2</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">m1</span>
            <span class="k">print</span> <span class="n">m2</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="s">&#39;scg&#39;</span>
        <span class="k">print</span> <span class="s">&quot;Gaussian&quot;</span>
        <span class="n">m1</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&quot;Laplace Gaussian&quot;</span>
        <span class="n">m2</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="n">debug</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">m1</span>
            <span class="k">print</span> <span class="n">m2</span>

        <span class="n">m2</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">m1</span><span class="p">[:]</span>

        <span class="c">#Predict for training points to get posterior mean and variance</span>
        <span class="n">post_mean</span><span class="p">,</span> <span class="n">post_var</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">post_mean_approx</span><span class="p">,</span> <span class="n">post_var_approx</span><span class="p">,</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pb</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;posterior means&#39;</span><span class="p">)</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">post_mean</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">post_mean_approx</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>

            <span class="n">pb</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;plot_f&#39;</span><span class="p">)</span>
            <span class="n">m1</span><span class="o">.</span><span class="n">plot_f</span><span class="p">(</span><span class="n">fignum</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">m2</span><span class="o">.</span><span class="n">plot_f</span><span class="p">(</span><span class="n">fignum</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">&#39;Covariance matricies&#39;</span><span class="p">)</span>
            <span class="n">a1</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
            <span class="n">a1</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">covariance_matrix</span><span class="p">)</span>
            <span class="n">a2</span> <span class="o">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
            <span class="n">a2</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">covariance_matrix</span><span class="p">)</span>

            <span class="n">pb</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">pb</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">m2</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>



        <span class="c">#Check Y&#39;s are the same</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">m2</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="c">#Check marginals are the same</span>
        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(),</span> <span class="n">m2</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(),</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#Check marginals are the same with random</span>
        <span class="n">m1</span><span class="o">.</span><span class="n">randomize</span><span class="p">()</span>
        <span class="n">m2</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">m1</span><span class="p">[:]</span>

        <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">assert_almost_equal</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(),</span> <span class="n">m2</span><span class="o">.</span><span class="n">log_likelihood</span><span class="p">(),</span> <span class="n">decimal</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c">#Check they are checkgradding</span>
        <span class="c">#m1.checkgrad(verbose=1)</span>
        <span class="c">#m2.checkgrad(verbose=1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">m2</span><span class="o">.</span><span class="n">checkgrad</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Running unit tests&quot;</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">GPy  documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../GPy.html" >GPy</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="../testing.html" >GPy.testing</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2013, Author.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>